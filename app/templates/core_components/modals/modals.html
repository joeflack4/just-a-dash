<!-- Dynamic Modals -->

{% if modals %}
  {% for modal in modals.keys()|sort -%}
        {# Variables #}
        {% set form = forms[modals[modal]['form_id']] %}

        {# Modal #}
        <div class="modal fade" id="{{ modals[modal]['id'] }}" tabindex="-1" role="dialog" aria-labelledby="{{ modals[modal]['aria_label'] }}">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="{{ modals[modal]['title_id'] }}">{{ modals[modal]['title'] }}</h4>
              </div>

              {# Form #}
              <div class="modal-body" align="left">
                <form id="{{ form.form_id }}" role="form" method='POST' action="">
                    {{ form.csrf_token }}

                    {% for field in form %}
                      <div class="form-group">
                          <p>{{ field(placeholder=field.name) }}
                            <span class="error">
{#                              {% if form.username.errors %}#}
{#                                {% for error in form.username.errors %} {{ error }} {% endfor %}#}
                              {% if field.errors %}
                                {% for error in field.errors %} {{ error }} {% endfor %}
                              {% endif %}
                          </span></p>
                      </div>
                    {% endfor %}

                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
              </div>
            </div>
          </div>
        </div>
  {% endfor %}
{% endif %}


<!-- Message Popup -->
    {% for message in messages %}
        <div class="modal fade" id="Message{{ message.id }}" tabindex="-1" role="dialog" aria-labelledby="Message{{ message.id }}">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="Messages{{ message.id }}Title">{{ message.title }}</h4>
              </div>

              <div class="modal-body" align="left">
                {{ message.body }}
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" data-dismiss="modal">Mark Read</button>
              </div>
            </div>
          </div>
        </div>
    {% endfor %}

{% if logged_in == False %}

<!-- Login Modal -->
    <div class="modal fade" id="LoginForm" tabindex="-1" role="dialog" aria-labelledby="LoginForm">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="LoginForm-Title">Login</h4>
          </div>

          <form id=LoginForm" role="form" method='POST' action={{ url_for('login') }}>
{#          <form id=LoginForm" role="form" method='POST'>#}
{#            {{ login_form.hidden_tag() }}#}
            {{ login_form.csrf_token }}
            <div class="modal-body" align="left">
              <div class="form-group">
{#                <label for="username-email">Username / E-mail</label>#}
{#                <input type="text" class="form-control" id="username-email" placeholder="Username/E-mail" name="username" value="{{ request.form.username }}">#}
                  <p>
                    {{ login_form.username(placeholder="username") }}
                    <span class="error">
                      {% if login_form.username.errors %}
                        {% for error in login_form.username.errors %}
                          {{ error }}
                        {% endfor %}
                      {% endif %}
                    </span>
                  </p>
              </div>
              <div class="form-group">
{#                <label for="password">Password</label>#}
{#                <input type="password" class="form-control" id="password" placeholder="Password" name="password" value="{{ request.form.password }}">#}
                  <p>
                  {{ login_form.password(placeholder="password") }}
                    <span class="error">
                      {% if login_form.password.errors %}
                        {% for error in login_form.password.errors %}
                          {{ error }}
                        {% endfor %}
                      {% endif %}
                    </span>
                  </p>
              </div>
{#              <div class="checkbox">#}
{#                <label>#}
{#                  <input type="checkbox"> Remember Me#}
{#                  {{ login_form.remember_me }} Remember Me#}
{#                </label>#}
{#              </div>#}
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Login</button>
            </div>
          </form>

        </div>
      </div>
    </div>

{#{% if register_form %}#}

<!-- Register Modal -->
    <div class="modal fade" id="RegisterForm" tabindex="-1" role="dialog" aria-labelledby="RegisterForm">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="RegisterForm-Title">Login</h4>
          </div>

          <form id=RegisterForm" role="form" method='POST' action={{ url_for('register') }}>
            <div class="modal-body" align="left">
                {{ register_form.csrf_token }}
                <div class="modal-body" align="left">
                  <div class="form-group">
                      <p>
                        {{ register_form.username(placeholder="username") }}
                        <span class="error">
                          {% if register_form.username.errors %}
                            {% for error in register_form.username.errors %}
                              {{ error }}
                            {% endfor %}
                          {% endif %}
                        </span>
                      </p>
                  </div>
                  <div class="form-group">
                      <p>
                      {{ register_form.email(placeholder="email") }}
                        <span class="error">
                          {% if register_form.password.errors %}
                            {% for error in register_form.email.errors %}
                              {{ error }}
                            {% endfor %}
                          {% endif %}
                        </span>
                      </p>
                  </div>
                  <div class="form-group">
                      <p>
                      {{ register_form.password(placeholder="password") }}
                        <span class="error">
                          {% if register_form.password.errors %}
                            {% for error in register_form.password.errors %}
                              {{ error }}
                            {% endfor %}
                          {% endif %}
                        </span>
                      </p>
                  </div>
                  <div class="form-group">
                      <p>
                      {{ register_form.confirm(placeholder="confirm password") }}
                        <span class="error">
                          {% if register_form.confirm.errors %}
                            {% for error in register_form.confirm.errors %}
                              {{ error }}
                            {% endfor %}
                          {% endif %}
                        </span>
                      </p>
                  </div>

{#              <div class="form-group">    #}
{#                <label for="username">Username</label>#}
{#                <input type="text" class="form-control" id="username" placeholder="Username">#}
{#              </div>#}
{#              <div class="form-group">#}
{#                <label for="email">E-mail Address</label>#}
{#                <input type="email" class="form-control" id="email" placeholder="E-mail">#}
{#              </div>#}
{#              <div class="form-group">#}
{#                <label for="password">Password</label>#}
{#                <input type="password" class="form-control" id="password" placeholder="Password">#}
{#              </div>#}
{#              <div class="form-group">#}
{#                <label for="repeat-password">Repeat Password</label>#}
{#                <input type="password" class="form-control" id="repeat-password" placeholder="Password">#}
{#              </div>#}
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Register</button>
            </div>
          </form>

        </div>
      </div>
    </div>

{% endif %}
